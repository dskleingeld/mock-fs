
\tikzstyle{headers}=[minimum width=2cm, minimum height=0.5cm, font=\normalsize]
\tikzstyle{base}=[minimum width=2cm, minimum height=0.5cm, font=\footnotesize]
\tikzstyle{neuron}=[base, rectangle, align=left, draw=black, fill=orange!30]
% \tikzstyle{neuron}=[thick,minimum width=0cm,align=left]

\begin{tikzpicture}[node distance=0.9cm and 1.0cm, auto]

    \node (start) [headers] {start};

    \node (wait)[neuron, below=of start]{wait till > 50\% \\of cluster discoverd};
    \node (discover)[neuron, left=of wait]{discover new\\ cluster members};

    \node (monitor_hb) [neuron,below=of wait] {monitor hb};
    \node (handle_update) [neuron,left=of monitor_hb] {handle fs changes};
    \node (host_fs) [neuron,right=of monitor_hb] {host fs meta};

    \node (update) [neuron,below=of host_fs] {synchronize meta\\ with master};
    \node (host_election) [neuron, below=of monitor_hb,] {host election};

    \node (ws) [below=of host_election] {};
    \node (maintain_hb) [neuron,below left=of ws] {maintain hb};
    \node (handle_meta) [neuron,below right=of ws] {handle meta\\ change requests};

	\node (S2) [base, right=of host_fs] {1};
	\node (S1) [base, above=of S2] {1};
	\node (S0) [base, above=of S1] {1};
	\node (S3) [base, below=of S2] {1};
	\node (S4) [base, below=of S3] {1};
	\node (S5) [base, below=of S4] {1};

    \draw[->, >=stealth, thick] (start) to [out=270, in=90] node [] {} (wait);
    \draw[->, >=stealth, thick] (start) to [out=270, in=90] node [] {} (discover);

    \draw[->, >=stealth, thick] (wait) to [out=270, in=90] node [] {} (handle_update);
    \draw[->, >=stealth, thick] (wait) to [out=270, in=90] node [near start, below left] {} (monitor_hb);
    \draw[->, >=stealth, thick] (wait) to [out=270, in=90] node [near start, below left] {} (host_fs);

    \draw[->, >=stealth, thick] (host_fs) to [out=270, in=90] node [near start, above] {} (update);
    \draw[->, >=stealth, thick] (monitor_hb) to [out=270, in=90] node [near start, below] {} (host_election);

    \draw[->, >=stealth, thick] (host_election) to [out=270, in=90] node [below] {} (maintain_hb);
    \draw[->, >=stealth, thick] (host_election) to [out=270, in=90] node [below] {} (handle_meta);

	% \draw [-, very thick, headers] (S0) to node {disconnected} (S1) ;
	% \draw [-, very thick, headers] (S1) to node {readserver} (S3) ;
	% \draw [-, very thick, headers] (S3) to node {writeserver} (S5) ;

\end{tikzpicture}
